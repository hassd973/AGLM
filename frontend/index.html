<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<title>A GRIEF Like Mine — Brand Kit (2025)</title>

<!-- Fonts: Modak + Sora sitewide. Sixtyfour is loaded but used ONLY for color names in the swatches. -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Modak&family=Sora:wght@300..800&family=Sixtyfour&display=swap" rel="stylesheet">

<style>
:root{
  /* ORIGINAL BRAND PALETTE (restored exactly) */
  --bg:#f7f6f3;          /* porcelain paper */
  /* Main logo colors */
  --blue1:#2c6fb1;       /* primary blue */
  --blue2:#6fb1ff;       /* sky */
  --blue3:#1d3f73;       /* deep blue */
  --sunset:#de9146;      /* sunset orange */
  --ink:#111111;         /* near-black */
  /* Extended blues */
  --blueA:#294b81;       /* extended */
  --blueB:#6b89bd;
  --blueC:#335694;
  /* Neutrals */
  --neutral1:#efe5d7;    /* oat */
  --neutral2:#ebe9d5;    /* bone */
  --neutral3:#f3f0ec;    /* porcelain */
  --rose:#dbb5c2;        /* accent */

  /* UI */
  --card:#ffffff;
  --muted:#4f5560;
  --shadow: 0 10px 30px rgba(0,0,0,.08);

  /* Derived tokens for components */
  --primary: var(--blue1);
  --primaryHover: color-mix(in srgb, var(--blue1) 80%, var(--blue2));
}

body.dark{
  --bg:#111111;
  --ink:#f3f0ec;
  --card:#1d1d1d;
  --muted:#bbbbbb;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:'Sora', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  line-height:1.45;
}
img{max-width:100%;height:auto}

.container{width:100%; margin:0 auto; padding:28px 20px 80px}
.header{
  display:flex; align-items:center; justify-content:space-between;
  gap:20px; padding:16px 0; position:sticky; top:0; background:linear-gradient(180deg, var(--bg), color-mix(in oklab, var(--bg) 85%, transparent));
  backdrop-filter: blur(6px);
  z-index:5;
}
.brand{ display:flex; align-items:center; gap:14px; }
.brand .dot{
  width:14px; height:14px; border-radius:50%; background:var(--blue1);
  box-shadow:0 0 0 6px color-mix(in srgb, var(--blue1) 12%, transparent);
}
/* Title readability (no condensation) */
.brand h1{ font-weight:400; font-size:48px; margin:0; letter-spacing:.01em; line-height:1.2; text-align:left; cursor:pointer }
.brand h1 #titleText{transition:opacity .4s}
.brand h1 #titleText.hidden{opacity:0}
.brand h1 #titleLogo{height:100px;display:none;opacity:0;transition:opacity .4s;vertical-align:middle}
.brand h1 #titleLogo.show{display:inline-block;opacity:1}
.brand h1 .modak{font-family:'Modak', cursive;}
.brand h1 .sora{font-family:'Sora', sans-serif;font-size:28px;}
@media(max-width:700px){ .brand h1{ font-size:32px } .brand h1 .sora{font-size:18px} }

.menu-wrap{display:flex;align-items:center;gap:14px}
.menu-wrap #menuToggle{display:none;background:none;border:none;font-size:24px;cursor:pointer;padding:6px 10px;border-radius:8px}
@media(max-width:700px){.menu-wrap #menuToggle{display:block}}
.header nav{display:flex; gap:14px; flex-wrap:wrap}
@media(max-width:700px){
  .header nav{display:none}
  .header nav:not(.hidden){display:flex}
}
.header a{ text-decoration:none; color:var(--ink); font-size:14px; opacity:.85; padding:6px 10px; border-radius:8px; }
.header a:hover{ background:color-mix(in srgb, var(--blue2) 18%, transparent); }

.grid{display:grid; grid-template-columns:repeat(12,1fr); gap:20px}
@media(max-width:700px){
  .grid{grid-template-columns:1fr}
  .grid .card{grid-column:span 12 !important}
}
.card{ background:var(--card); border-radius:18px; padding:18px; box-shadow:var(--shadow); }

/* Hero */
.hero{ position:relative; border-radius:22px; padding:28px; overflow:hidden; background:var(--card); box-shadow:var(--shadow) }
.hero h2{ font-family:'Sora', sans-serif; margin:0 0 10px; font-size:28px; letter-spacing:.01em }
.hero p{ margin:0; color:var(--muted) }

/* Floating sprites — idle only */
.particles{ position:absolute; inset:0; pointer-events:none; z-index:2 }
.sprite{ position:absolute; width:clamp(24px,2.6vw,34px); transform-origin:50% 60%;
         opacity:.95; filter:drop-shadow(0 2px 2px rgba(0,0,0,.12)); animation:floatY var(--dur,6s) ease-in-out infinite }
.sprite svg{ display:block; width:100%; height:auto }
.sprite .wing{ animation:flap var(--flap,1200ms) ease-in-out infinite; }
@keyframes flap{ 0%,100%{ transform:rotate(0) } 50%{ transform:rotate(var(--arc,14deg)) } }
@keyframes floatY{ 0%,100%{ transform:translateY(-6px) rotate(var(--start,0deg)) } 50%{ transform:translateY(6px) rotate(var(--end,-2deg)) } }

/* Global flock sprites */
.flock-layer{position:fixed;inset:0;pointer-events:none;z-index:1000}
.flock{position:absolute;width:clamp(18px,2vw,28px);opacity:0;transform-origin:50% 70%;filter:drop-shadow(0 1px 0 rgba(0,0,0,.12));}
.flock svg{display:block;width:100%;height:auto}
.flock .wing{animation:flap var(--flap,460ms) ease-in-out infinite}
.flock.fly{animation:flight var(--dur,2800ms) cubic-bezier(.2,.6,.1,1) forwards}
@keyframes flight{
 0%{opacity:0;transform:translate(var(--x,0),var(--y,0)) rotate(var(--r0,0deg)) scale(var(--s,1))}
 8%{opacity:1}
 100%{opacity:0;transform:translate(calc(var(--x) + var(--dx,0)), calc(var(--y) + var(--dy,0))) rotate(var(--r1,-20deg)) scale(calc(var(--s,1)*.8))}
}

/* Logo stage */
.stage{ position:relative; display:grid; place-items:center; aspect-ratio:1/1; background:var(--neutral3); border-radius:20px; overflow:hidden; }
.stage .overlay-note{ position:absolute; bottom:10px; right:10px; font-size:12px; background:rgba(255,255,255,.8); padding:6px 10px; border-radius:10px; color:#333; box-shadow:0 6px 20px rgba(0,0,0,.08); }
.stage img{width:80%;height:auto}
.fullscreen-link{position:absolute;top:10px;right:10px;width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center;text-decoration:none;color:#333;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.fullscreen-link::before{content:'↗';font-size:14px}

.actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:14px }
button, .btn{
  appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; background:var(--primary); color:white;
  box-shadow:0 6px 16px rgba(44,111,177,.25);
}
button:hover{ background:var(--primaryHover) }
button.secondary{ background:#fff; color:var(--ink); border:1px solid color-mix(in srgb, var(--ink) 12%, transparent) }
.btn:focus, button:focus{ outline:2px solid color-mix(in srgb, var(--blue2) 40%, transparent) }

/* Color swatches */
.swatches{ display:grid; grid-template-columns:repeat(auto-fit, minmax(160px,1fr)); gap:14px }
.swatch{ border-radius:14px; padding:14px; background:#fff; box-shadow:var(--shadow); transition:transform .2s; cursor:pointer }
.swatch:hover{ transform:scale(1.05) }
.swatch .chip{ height:56px; border-radius:12px; margin-bottom:10px }
.swatch code{ font-family:'Sora', sans-serif; font-size:13px; color:#333; }
/* Sixtyfour ONLY here for color titles */
.swatch h4{ margin:2px 0 6px; font-family:'Sixtyfour', sans-serif; font-weight:200; letter-spacing:.02em; font-variation-settings:"BLED" 0, "SCAN" 0 }

/* Fullscreen color modal */
.color-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.8);z-index:1000}
.color-modal .close-modal{position:absolute;top:20px;right:20px;background:none;border:0;color:#fff;font-size:32px;cursor:pointer}
.color-modal .usage-logo{max-width:40%;height:auto}
.color-modal .toggle-logo{position:absolute;bottom:20px;left:20px;background:rgba(0,0,0,.4);color:#fff;border:0;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:14px}

/* Typography examples */
.type-row{ display:grid; grid-template-columns:1fr; gap:8px }
.sample{ padding:12px 14px; border-radius:12px; background:#fff; box-shadow:var(--shadow) }
.sample .cap{ font-size:12px; color:#666; margin-bottom:6px }
.sample .text{ font-size:28px; }

/* Typography generator */
.type-tool{margin-top:20px;}
.type-tool textarea{width:100%;min-height:80px;padding:10px;border-radius:8px;border:1px solid #ccc;font-family:'Sora',sans-serif;font-size:16px}
.type-tool .controls{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0}
.type-tool canvas{display:none}
.type-tool .canvas{margin-top:10px;background:#fff;box-shadow:var(--shadow);width:100%;max-width:400px;height:400px;background-size:cover;background-position:center;border-radius:12px}

/* Social templates */
.templates{ display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:14px }
.frame{ background:var(--card); border-radius:18px; padding:12px; box-shadow:var(--shadow) }
.canvas{ position:relative; border-radius:12px; background:var(--neutral3); display:grid; place-items:center; overflow:hidden }
.canvas > *{ grid-area:1/1; }
.canvas.square{ aspect-ratio:1/1 }
.canvas.portrait{ aspect-ratio:4/5 }
.canvas.landscape{ aspect-ratio:16/9 }
.canvas .ghost{ opacity:.22; font-family:'Modak', cursive; letter-spacing:.04em }
.canvas img{ max-width:80%; max-height:80%; width:auto; height:auto; object-fit:contain; object-position:center; }
.canvas.landscape .template-img{
  max-width:100%;
  max-height:100%;
  width:auto;
  height:auto;
}
.canvas video{ max-width:80%; max-height:80%; width:auto; height:auto; object-fit:contain; object-position:center; }
#breakTemplates .canvas video{width:100%;height:100%;object-fit:cover;}
.canvas .user-media{width:100%;height:100%;object-fit:cover;max-width:none;max-height:none;position:relative;z-index:1;}
.canvas .template-img{position:relative;z-index:3;}
.canvas .template-text{position:relative;z-index:2;color:#fff;font-family:'Sora',sans-serif;font-size:clamp(16px,5vw,32px);text-align:center;padding:10px;}
.border-overlay{position:absolute;inset:0;border-radius:12px;pointer-events:none;z-index:4;}

/* Logo positioning helpers */
.canvas.logo-center .template-img{width:80%;align-self:center;justify-self:center;}
.canvas.logo-top .template-img{width:30%;align-self:start;justify-self:center;margin-top:10px;}
.canvas.logo-bottom .template-img{width:30%;align-self:end;justify-self:center;margin-bottom:10px;}
.canvas.logo-left .template-img{width:25%;align-self:center;justify-self:start;margin-left:10px;}
.canvas.logo-right .template-img{width:25%;align-self:center;justify-self:end;margin-right:10px;}

.canvas.logo-center .template-text,
.canvas.logo-top .template-text,
.canvas.logo-bottom .template-text{align-self:center;justify-self:center;margin:0 10px;text-align:center;}
.canvas.logo-left .template-text{align-self:center;justify-self:end;margin:0 10px;text-align:right;max-width:70%;}
.canvas.logo-right .template-text{align-self:center;justify-self:start;margin:0 10px;text-align:left;max-width:70%;}
#photoExample .canvas img,
#photoExample .canvas video{
  width:100%;
  height:100%;
  max-width:none;
  max-height:none;
  object-fit:cover;
}
.download{ margin-top:6px; font-size:12px; }

/* Section headings */
h3.section{ font-family:'Sora', sans-serif; font-weight:400; margin:28px 0 12px; font-size:48px; letter-spacing:.01em }
@media(max-width:700px){ h3.section{ font-size:32px } }

footer{ margin-top:30px; color:#666; font-size:12px; text-align:center }

/* Small helpers */
.mono{ font-family:'Sora', sans-serif }
.nowrap{ white-space:nowrap }
.drop{ display:inline-block; padding:8px 10px; border:1px dashed color-mix(in srgb, var(--ink) 25%, transparent); border-radius:10px; font-size:12px; color:#555 }

/* Photo tool */
#photoTool{margin-top:20px;position:relative;}
#photoTool .camera-wrap{position:relative;width:100%;max-width:480px;}
#photoTool .camera-wrap video{width:100%;border-radius:16px;background:#000;}
#photoTool .camera-wrap canvas{position:absolute;top:0;left:0;width:100%;height:100%;display:none;}
#photoTool .controls{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;}
#photoTool button{padding:8px 12px;border:none;border-radius:8px;background:var(--blue1);color:#fff;font-weight:500;cursor:pointer;}
#photoTool button:hover{background:var(--blue2);color:#111;}
#photoTool #suggestion{margin-top:14px;font-size:18px;font-weight:600;}
#photoTool .swatches{display:flex;gap:10px;margin-top:10px;}
#photoTool .swatch{width:40px;height:40px;border-radius:8px;box-shadow:0 0 0 2px rgba(0,0,0,.1);}
#photoTool .camera-wrap .overlay{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);color:#fff;font-size:24px;text-align:center;pointer-events:none;z-index:2;}
#photoTool .camera-wrap #overlayLogo{width:120px;height:auto;}
#photoTool .camera-wrap #colorOverlay{position:absolute;inset:0;pointer-events:none;display:none;opacity:.3;z-index:1;border-radius:16px;}
#photoTool.fullscreen{position:fixed;inset:0;background:#000;z-index:1000;padding:0;}
#photoTool.fullscreen .camera-wrap{width:100%;height:100%;}
#photoTool.fullscreen .camera-wrap video{width:100%;height:100%;object-fit:cover;}
#photoTool .fs-controls{display:none;position:absolute;top:10px;right:10px;left:auto;gap:8px;align-items:center;}
#photoTool.fullscreen .fs-controls{display:flex;}
#photoTool .fs-controls .swatch{width:30px;height:30px;border-radius:50%;cursor:pointer;box-shadow:0 0 0 2px rgba(0,0,0,.2);}
#photoTool .fs-controls .capture{margin-left:10px;background:rgba(0,0,0,.4);color:#fff;border:0;border-radius:50%;width:30px;height:30px;cursor:pointer;}
#photoTool .fs-controls .exit{margin-left:10px;background:rgba(0,0,0,.4);color:#fff;border:0;border-radius:50%;width:30px;height:30px;cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="brand">
      <div class="dot"></div>
      <h1><span class="modak" id="titleText">A GRIEF<br>Like Mine</span><img id="titleLogo" src="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png" alt="AGLM logo"/><br><span class="sora">— Brand Kit</span></h1>
    </div>
    <div class="menu-wrap">
      <button id="menuToggle" type="button" aria-label="Toggle menu">☰</button>
      <nav class="hidden">
        <a href="#overview">Overview</a>
        <a href="#logo">Logo Usage</a>
        <a href="#colors">Colors</a>
        <a href="#type">Typography</a>
        <a href="#templates">Social Templates</a>
        <a href="#photos">Photo Direction</a>
        <a href="photo-guide.html">Photo Tool</a>
        <a href="#exports">Exports</a>
        <button id="lightMode" class="btn secondary" type="button" aria-label="Light Mode">☀️</button>
        <button id="darkMode" class="btn secondary" type="button" aria-label="Dark Mode">🌙</button>
      </nav>
    </div>
  </header>

  <section id="overview" class="hero card">
    <div class="particles" id="particles"></div>
    <h2>Overview</h2>
    <p>This page previews the <strong>2025</strong> brand system using only <strong>Modak</strong> and <strong>Sora</strong>. Brand colors are restored to the original blues + neutrals. The <span class="mono">Sixtyfour</span> font is used <em>only</em> for swatch titles in the Colors section.</p>
  </section>

  <section id="logo" class="grid" style="margin-top:22px">
    <div class="card" style="grid-column: span 7;">
      <h3 class="section">Main Logo — “A Grief Like Mine — 1×1 Center”</h3>
      <div class="stage" id="logoStage">
        <img id="brandLogoIMG"
             src="https://i.ibb.co/N2Lr6c4s/A-Grief-Like-Mine-1x1-center.png"p
             alt="A Grief Like Mine — 1×1 Center" />
        <a id="logoStageLink" class="fullscreen-link" href="https://i.ibb.co/N2Lr6c4s/A-Grief-Like-Mine-1x1-center.png" aria-label="Open full image"></a>
      </div>
      <div class="actions">
        <label class="drop" for="logoUpload">Upload logo (SVG / PNG / AI / PDF)</label>
        <input id="logoUpload" type="file" accept="image/svg+xml,image/png,.ai,application/pdf" style="position:absolute;opacity:0;pointer-events:none" aria-hidden="true" />
        <button id="exportPNG">Download PNG (transparent, 3000×3000)</button>
        <button class="secondary" id="toggleBG">Toggle Preview BG</button>
      </div>
      <div style="margin-top:10px; color:#555; font-size:13px">
        <strong>Clearspace:</strong> Maintain “G” height around the mark. <span class="nowrap"><strong>Min size:</strong> 32 px</span>. Avoid drop‑shadows or strokes on the logo.
      </div>
    </div>

    <div class="card" style="grid-column: span 5;">
      <h3 class="section">Logo Usage</h3>
      <ul style="margin:0 0 6px 18px">
        <li>Use the centered 1×1 mark for avatars, favicons, stickers, and profile icons.</li>
        <li>On light backgrounds, prefer the full‑color mark (blues + ink). On dark, use an all‑white version.</li>
        <li>Do not skew, warp, or add effects. Do not re‑color outside the approved palette.</li>
        <li>Maintain contrast ratio ≥ 4.5:1 when placing over photos.</li>
      </ul>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px">
        <div class="stage" style="aspect-ratio:1/1; background:#fff" id="logoLight">
          <img id="logoLightIMG" src="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png" alt="Logo on light"/>
          <a id="logoLightLink" class="fullscreen-link" href="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png" aria-label="Open full image"></a>
        </div>
        <div class="stage" style="aspect-ratio:1/1; background:#111" id="logoDark">
          <img id="logoDarkIMG" src="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png" alt="Logo on dark"/>
          <a class="fullscreen-link" data-bg="#000" href="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png" aria-label="Open full image"></a>
        </div>
      </div>
    </div>

    <div class="card" style="grid-column: span 12; margin-top:20px;">
      <h3 class="section">Alternative Logo — Illustration 3D</h3>
      <div class="stage" id="altLogoStage">
        <img id="altLogoIMG" src="https://i.ibb.co/gLsRFMTd/AGLM-Illustration-3-D-logo-large.png" alt="AGLM Illustration 3D logo"/>
        <a id="altLogoLink" class="fullscreen-link" href="https://i.ibb.co/gLsRFMTd/AGLM-Illustration-3-D-logo-large.png" aria-label="Open full image"></a>
      </div>
    </div>
  </section>

  <section id="colors" class="card" style="margin-top:22px">
    <h3 class="section">Color Guide</h3>
    <div class="swatches">
      <div class="swatch"><div class="chip" style="background:var(--blue1)"></div><h4>Primary Blue</h4><code>#2C6FB1</code></div>
      <div class="swatch"><div class="chip" style="background:var(--blue2)"></div><h4>Sky</h4><code>#6FB1FF</code></div>
      <div class="swatch"><div class="chip" style="background:var(--blue3)"></div><h4>Deep Blue</h4><code>#1D3F73</code></div>
      <div class="swatch"><div class="chip" style="background:var(--sunset)"></div><h4>Sunset Orange</h4><code>#DE9146</code></div>
      <div class="swatch"><div class="chip" style="background:var(--ink)"></div><h4>Ink</h4><code>#111111</code></div>
      <div class="swatch"><div class="chip" style="background:var(--blueA)"></div><h4>Blue A</h4><code>#294B81</code></div>
      <div class="swatch"><div class="chip" style="background:var(--blueB)"></div><h4>Blue B</h4><code>#6B89BD</code></div>
      <div class="swatch"><div class="chip" style="background:var(--blueC)"></div><h4>Blue C</h4><code>#335694</code></div>
      <div class="swatch"><div class="chip" style="background:var(--neutral3)"></div><h4>Porcelain</h4><code>#F3F0EC</code></div>
      <div class="swatch"><div class="chip" style="background:var(--neutral2)"></div><h4>Bone</h4><code>#EBE9D5</code></div>
      <div class="swatch"><div class="chip" style="background:var(--neutral1)"></div><h4>Oat</h4><code>#EFE5D7</code></div>
      <div class="swatch"><div class="chip" style="background:var(--rose)"></div><h4>Rose Accent</h4><code>#DBB5C2</code></div>
    </div>
    <p style="margin-top:10px; color:#555; font-size:13px">All UI and illustrations should reference these CSS tokens. Neutrals for surfaces; blues for hero/accents; rose sparingly.</p>
    <div id="colorDayWrap" style="margin-top:20px;">
      <button id="colorOfDayBtn" class="btn secondary">Color of the Day</button>
      <div id="colorOfDayDisplay" class="swatch" style="margin-top:10px;display:none;">
        <div class="chip"></div><h4>Color of the Day</h4><code></code>
      </div>
    </div>
    <div style="margin-top:20px;">
      <label>Color Wheel <input type="color" id="colorWheel" value="#2c6fb1" /></label>
      <div id="complementaryDisplay" class="swatch" style="margin-top:10px;display:none;">
        <div class="chip"></div><h4>Complementary</h4><code></code>
      </div>
    </div>
    <div style="margin-top:20px;">
      <label>Add Custom Color <input type="color" id="customColorPicker" /></label>
      <button id="addCustomColor" class="btn secondary">Add Color</button>
      <div id="customSwatches" class="swatches" style="margin-top:10px"></div>
      <button id="downloadSwatches" class="btn secondary" style="margin-top:10px">Download Swatches</button>
    </div>
  </section>

    <section id="type" class="card" style="margin-top:22px">
      <h3 class="section">Typography</h3>
    <div class="type-row">
      <div class="sample">
        <div class="cap">Display — Modak</div>
        <div class="text" style="font-family:'Modak', cursive;">A Grief Like Mine</div>
      </div>
      <div class="sample">
        <div class="cap">Body & UI — Sora</div>
        <div class="text" style="font-family:'Sora', sans-serif; font-weight:500;">The sea remembers. We move gently, not swiftly.</div>
      </div>
    </div>

    <div class="type-tool">
      <textarea id="typeInput" placeholder="Write a quote..."></textarea>
      <div class="controls">
          <label>Font
            <select id="fontSelect">
              <option value="Sora">Sora</option>
              <option value="Modak">Modak</option>
            </select>
          </label>
          <label>Font size
            <input id="fontSize" type="number" value="120" min="20" max="300" />
          </label>
          <label>Logo position
            <select id="logoPos">
              <option value="none">None</option>
              <option value="bottom-right">Bottom Right</option>
              <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
            <option value="top-center">Top Center</option>
            <option value="bottom-center">Bottom Center</option>
          </select>
        </label>
        <button id="typeNextLogo" class="btn secondary">Next Logo</button>
        <label>BG color
          <select id="bgColor">
            <option value="#ffffff">White</option>
            <option value="#f3f0ec">Porcelain</option>
            <option value="#2c6fb1">Blue</option>
            <option value="#6fb1ff">Sky</option>
            <option value="#1d3f73">Deep Blue</option>
            <option value="#de9146">Sunset</option>
            <option value="#dbb5c2">Rose</option>
          </select>
        </label>
        <button id="downloadPNG" class="btn secondary">Download PNG</button>
      </div>
      <canvas id="typeCanvas" width="3000" height="3000"></canvas>
      <div id="typePreview" class="canvas square"><div class="ghost">Preview</div></div>
    </div>
  </section>

  <section id="kinetic" class="card" style="margin-top:22px">
    <h3 class="section" title="Animated text samples">Kinetic Typography</h3>
    <div class="stage">
      <iframe
        src="kinetic-typography.html"
        title="Kinetic Typography"
        style="width:100%;height:100%;border:0"
        loading="lazy"
        sandbox="allow-scripts"
      ></iframe>
      <a class="fullscreen-link" href="kinetic-typography.html" aria-label="Open full view"></a>
    </div>
  </section>

  <section id="templates" class="card" style="margin-top:22px">
    <h3 class="section" title="Create shareable graphics">Social Templates</h3>
    <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:14px;align-items:center;">
      <label for="mediaUpload" class="btn secondary" title="Upload an image or short video">Upload Photo/Video</label>
      <input id="mediaUpload" type="file" accept="image/*,video/*" style="display:none" />
      <button id="recordVideo" class="btn secondary" title="Record a short video">Record Video</button>
      <input id="templateText" type="text" placeholder="Add text" style="flex:1;min-width:120px" title="Enter overlay text" />
      <select id="templateFont" title="Choose text font">
        <option value="Sora">Sora</option>
        <option value="Modak">Modak</option>
      </select>
      <select id="templateLogoPos" title="Logo position">
        <option value="center">Center</option>
        <option value="top">Top Center</option>
        <option value="bottom">Bottom Center</option>
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select>
      <button id="cycleLogo" class="btn secondary" title="Switch logo">Next Logo</button>
      <button id="toggleLogo" class="btn secondary" title="Show or hide the logo">Hide Logo</button>
      <button id="toggleShadow" class="btn secondary" title="Toggle text shadow">Add Shadow</button>
      <button id="removeMedia" class="btn secondary" title="Remove uploaded media">Remove Media</button>
      <label title="Border color" style="display:flex;align-items:center;gap:4px;">
        Border
        <select id="borderColor">
          <option value="">None</option>
          <option value="#2c6fb1">Primary Blue</option>
          <option value="#6fb1ff">Sky</option>
          <option value="#1d3f73">Deep Blue</option>
          <option value="#de9146">Sunset</option>
          <option value="#111111">Ink</option>
          <option value="#dbb5c2">Rose</option>
          <option value="#efe5d7">Oat</option>
          <option value="#ebe9d5">Bone</option>
          <option value="#f3f0ec">Porcelain</option>
        </select>
      </label>
      <label title="Border width" style="display:flex;align-items:center;gap:4px;">
        Width
        <input id="borderWidth" type="number" value="0" min="0" max="40" style="width:60px" />
      </label>
      <label title="Text size" style="display:flex;align-items:center;gap:4px;">
        Text Size
        <input id="templateSize" type="range" min="12" max="72" value="32" />
      </label>
      <label title="Text horizontal position" style="display:flex;align-items:center;gap:4px;">
        Text X
        <input id="textX" type="range" min="-50" max="50" value="0" />
      </label>
      <label title="Text vertical position" style="display:flex;align-items:center;gap:4px;">
        Text Y
        <input id="textY" type="range" min="-50" max="50" value="0" />
      </label>
    </div>
    <div id="templateColors" class="swatches" style="margin-bottom:14px"></div>
    <div class="templates" id="logoTemplates">
      <div class="frame">
        <div class="canvas square"><div class="template-text"></div><img class="template-img" alt="Logo"><div class="ghost">1×1</div></div>
        <button class="download" data-size="square" title="Download square graphic">Download 1×1</button>
        <div style="font-size:12px; margin-top:6px; color:#555">Profile / Grid</div>
      </div>
      <div class="frame">
        <div class="canvas portrait"><div class="template-text"></div><img class="template-img" alt="Logo"><div class="ghost">4×5</div></div>
        <button class="download" data-size="portrait" title="Download portrait graphic">Download 4×5</button>
        <div style="font-size:12px; margin-top:6px; color:#555">IG Portrait</div>
      </div>
      <div class="frame">
        <div class="canvas landscape"><div class="template-text"></div><img class="template-img" alt="Logo"><div class="ghost">16×9</div></div>
        <button class="download" data-size="landscape" title="Download landscape graphic">Download 16×9</button>
        <div style="font-size:12px; margin-top:6px; color:#555">Video / YouTube</div>
      </div>
    </div>

    <h4 style="margin-top:30px" title="Looping videos for breaks">Break Animations</h4>
    <button id="cycleVideo" class="btn secondary" style="margin-bottom:14px" title="Switch to next break animation">Next Animation</button>
    <div id="videoColors" class="swatches" style="margin-bottom:14px"></div>
    <div class="templates" id="breakTemplates">
      <div class="frame">
        <div class="canvas square"><video class="break-video" loop muted playsinline autoplay></video><div class="ghost">1×1</div></div>
        <button class="download-vid" data-size="square" title="Download square animation">Download 1×1</button>
        <div style="font-size:12px; margin-top:6px; color:#555">Profile / Grid</div>
      </div>
      <div class="frame">
        <div class="canvas portrait"><video class="break-video" loop muted playsinline autoplay></video><div class="ghost">4×5</div></div>
        <button class="download-vid" data-size="portrait" title="Download portrait animation">Download 4×5</button>
        <div style="font-size:12px; margin-top:6px; color:#555">IG Portrait</div>
      </div>
      <div class="frame">
        <div class="canvas landscape"><video class="break-video" loop muted playsinline autoplay></video><div class="ghost">16×9</div></div>
        <button class="download-vid" data-size="landscape" title="Download landscape animation">Download 16×9</button>
        <div style="font-size:12px; margin-top:6px; color:#555">Video / YouTube</div>
      </div>
    </div>
    <h4 style="margin-top:30px">Instagram Carousel Generator</h4>
    <div id="aglm-carousel-controls" style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:14px;align-items:flex-start;">
      <select id="aglm-template-type" title="Template type">
        <option value="event">Event Announcement</option>
        <option value="save">Save the Date</option>
      </select>
      <select id="aglm-aspect" title="Aspect ratio">
        <option value="square">Square 1080×1080</option>
        <option value="portrait">Portrait 1080×1350</option>
      </select>
      <select id="aglm-bg-color" title="Background color">
        <option value="#2c6fb1">Blue 1</option>
        <option value="#6fb1ff">Blue 2</option>
        <option value="#1d3f73">Deep Blue</option>
        <option value="#294b81">Blue A</option>
        <option value="#6b89bd">Blue B</option>
        <option value="#335694">Blue C</option>
        <option value="#efe5d7">Oat</option>
        <option value="#ebe9d5">Bone</option>
        <option value="#f3f0ec">Porcelain</option>
        <option value="#dbb5c2">Rose</option>
        <option value="#111111">Ink</option>
      </select>
      <select id="aglm-accent-color" title="Accent color">
        <option value="#2c6fb1">Blue 1</option>
        <option value="#6fb1ff">Blue 2</option>
        <option value="#1d3f73">Deep Blue</option>
        <option value="#294b81">Blue A</option>
        <option value="#6b89bd">Blue B</option>
        <option value="#335694">Blue C</option>
        <option value="#efe5d7">Oat</option>
        <option value="#ebe9d5">Bone</option>
        <option value="#f3f0ec">Porcelain</option>
        <option value="#dbb5c2">Rose</option>
        <option value="#111111">Ink</option>
      </select>
      <input id="aglm-headline" type="text" placeholder="Headline" style="flex:1;min-width:120px" />
      <textarea id="aglm-details" placeholder="Details" style="flex:1;min-width:120px"></textarea>
      <input id="aglm-bg-url" type="url" placeholder="Background image URL (optional)" style="flex:1;min-width:120px" />
      <input id="aglm-bg-file" type="file" accept="image/png,image/jpeg,image/webp,video/mp4" />
      <select id="aglm-text-color" title="Text color">
        <option value="#000000">Black</option>
        <option value="#111111">Ink</option>
        <option value="#ffffff">White</option>
        <option value="#2c6fb1">Blue 1</option>
        <option value="#6fb1ff">Blue 2</option>
        <option value="#1d3f73">Deep Blue</option>
        <option value="#294b81">Blue A</option>
        <option value="#6b89bd">Blue B</option>
        <option value="#335694">Blue C</option>
        <option value="#efe5d7">Oat</option>
        <option value="#ebe9d5">Bone</option>
        <option value="#f3f0ec">Porcelain</option>
        <option value="#dbb5c2">Rose</option>
      </select>
      <select id="aglm-font-family" title="Font family">
        <option value="Sora" selected>Sora</option>
        <option value="Modak">Modak</option>
        <option value="system-ui">System Sans</option>
      </select>
      <select id="aglm-font-weight" title="Font weight">
        <option value="400">Regular</option>
        <option value="600">Semi Bold</option>
        <option value="700" selected>Bold</option>
        <option value="800">Extra Bold</option>
      </select>
      <select id="aglm-logo-select" title="Logo">
        <option value="0">Logo 1</option>
        <option value="1">Logo 2</option>
        <option value="2">Logo 3</option>
      </select>
      <select id="aglm-logo-pos" title="Logo position">
        <option value="bottom-right">Bottom Right</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="top-right">Top Right</option>
        <option value="top-left">Top Left</option>
      </select>
      <input id="aglm-logo-size" type="number" value="300" min="50" max="600" title="Logo size" />
      <input id="aglm-headline-size" type="number" value="70" min="20" max="200" title="Headline size" />
      <input id="aglm-details-size" type="number" value="40" min="10" max="120" title="Details size" />
      <input id="aglm-text-y" type="number" value="540" min="0" max="1000" title="Text Y position" />
      <button id="aglm-generate" class="btn secondary">Generate</button>
      <button id="aglm-download" class="btn secondary">Download PNG</button>
      <button id="aglm-print" class="btn secondary">Print/Save PDF</button>
    </div>
    <canvas id="aglm-carousel-canvas" width="1080" height="1080" style="width:100%;max-width:540px;border-radius:12px;box-shadow:var(--shadow);background:#fff;"></canvas>
  </section>

  <section id="photos" class="card" style="margin-top:22px">
    <h3 class="section" title="Photography tips and camera tool">Photo Direction</h3>
    <ul style="margin:0 0 0 18px">
      <li>Cool light, north‑facing or overcast. Avoid direct midday sun.</li>
      <li>Textures: paper, linen, water, matte ceramics. Minimal gloss.</li>
      <li>Palette: blues + bone neutrals; occasional rose accent.</li>
      <li>Negative space for type; keep horizon lines calm.</li>
    </ul>
    <div id="photoTool">
      <div class="camera-wrap">
        <video id="video" playsinline></video>
        <canvas id="canvas" width="200" height="150" style="display:none"></canvas>
        <div id="overlayText" class="overlay" style="display:none"></div>
        <img id="overlayLogo" class="overlay" alt="Overlay logo" style="display:none"/>
        <div id="colorOverlay"></div>
      </div>
      <div id="fsControls" class="fs-controls">
        <div class="swatch"></div>
        <div class="swatch"></div>
        <div class="swatch"></div>
        <button id="fsCapture" class="capture">📸</button>
        <button id="exitFs" class="exit">↩</button>
      </div>
      <div class="controls">
        <button id="startBtn" title="Enable your camera">Activate Camera</button>
        <button id="stopBtn" title="Turn off the camera">Deactivate Camera</button>
        <button id="switchBtn" title="Flip between front and back cameras">Switch Camera</button>
        <button id="colorBtn" title="Cycle through palette colors">Next Color</button>
        <button id="downloadPhoto" title="Save current frame">Download Photo</button>
          <button id="fullscreenBtn" title="Open full screen mode">Full Screen</button>
          <select id="overlaySelect" title="Choose an overlay for the camera feed">
            <option value="none">No Overlay</option>
            <option value="text">Typography Text</option>
            <option value="logo1">Logo 1</option>
            <option value="logo2">Logo 2</option>
            <option value="logo3">Logo 3</option>
          </select>
          <input id="captionInput" type="text" placeholder="Caption" style="display:none" title="Overlay caption" />
          <input id="captionColor" type="color" value="#ffffff" style="display:none" title="Caption color" />
        </div>
      <p id="suggestion">Camera inactive.</p>
      <h4>Do</h4>
      <div id="photoExample" class="templates" style="margin-top:20px;">
        <div class="frame">
          <div class="canvas square">
            <img src="assets/photo%20tool.png" alt="Photo tool example"/>
          </div>
        </div>
        <div class="frame">
          <div class="canvas square">
            <video id="photoExampleVideo" src="assets/Photo%20Tool.mp4" loop muted playsinline autoplay></video>
          </div>
        </div>
      </div>
      <iframe id="aglm-pinterest" src="https://assets.pinterest.com/ext/embed.html?id=4ARHEk46o" loading="lazy" style="width:100%;border:0;height:400px;margin-top:14px;"></iframe>
      <div id="combos" class="swatches"></div>
    </div>
    <h4 style="margin-top:20px">Don't</h4>
    <p style="font-size:14px;color:#555;margin-top:6px;">Upload your "don't" shots below. Submissions stay live for 30 days and the community can upvote to rank the top five.</p>
    <input id="aglm-dont-input" type="file" accept="image/png,image/jpeg,image/webp,video/mp4" multiple />
    <div id="aglm-dont-gallery" class="templates" style="margin-top:14px;"></div>
  </section>

  <section id="exports" class="card" style="margin-top:22px">
    <h3 class="section" title="Download high-res logos">Exports</h3>
    <p>Upload your approved logo (SVG or PNG) and click <strong>Download PNG</strong> to export a high‑res transparent PNG of the centered logo (3000×3000). If you only have an <strong>.ai</strong> file, export it to <em>SVG</em> or <em>PNG</em> first, then upload here.</p>
    <div style="font-size:12px; color:#666">Note: Export uses client‑side canvas for transparency and crisp edges.</div>
  </section>

  <footer>© 2025 A GRIEF LIKE MINE — Brand system preview</footer>
</div>

<!-- Hidden symbol rigs for the idle-only bird & butterfly -->
<svg width="0" height="0" aria-hidden="true" focusable="false">
  <symbol id="BIRD_RIG" viewBox="0 0 100 80">
    <path fill="var(--blue1)" d="M53,44c8,0,17-8,17-16c0-9-9-16-20-16c-10,0-18,6-21,13c-8,2-15,9-15,16c0,7,6,12,15,12c9,0,17-4,24-9z"/>
    <path fill="var(--blue3)" d="M35,45l-18,16l10-3l-7,12l17-17z"/>
    <path fill="var(--blue2)" d="M70,26l14-4l-10,10z"/>
    <circle cx="61" cy="23" r="2.1" fill="#0b1d36"/>
    <g class="wing" style="transform-origin:40px 33px; --arc:10deg">
      <path fill="var(--blue2)" d="M18,20c8,3,18,8,24,14c-8,0-17-1-26-3c-6-2-6-9,2-11z"/>
    </g>
    <g class="wing" style="transform-origin:62px 38px; --arc:10deg">
      <path fill="var(--blue2)" d="M42,30c10,2,21,7,28,13c-8,1-17,0-27-2c-6-2-6-9-1-11z"/>
    </g>
  </symbol>
  <symbol id="BUTTER_RIG" viewBox="0 0 100 80">
    <rect x="48" y="30" width="4" height="22" rx="2" fill="var(--blue3)"/>
    <circle cx="50" cy="28" r="5" fill="var(--blue3)"/>
    <g class="wing" style="transform-origin:52px 40px; --arc:16deg">
      <path fill="var(--blue1)" d="M50,40 C25,15 10,35 15,47 C20,60 35,58 48,46 Z"/>
      <circle cx="37" cy="45" r="4" fill="var(--blue2)"/>
    </g>
    <g class="wing" style="transform-origin:48px 40px; --arc:-16deg">
      <path fill="var(--blue1)" d="M50,40 C75,15 90,35 85,47 C80,60 65,58 52,46 Z"/>
      <circle cx="63" cy="45" r="4" fill="var(--blue2)"/>
    </g>
  </symbol>
</svg>

<div id="colorModal" class="color-modal" aria-hidden="true">
  <button class="close-modal" aria-label="Close">&times;</button>
  <button class="toggle-logo" aria-label="Toggle logo">Logo</button>
  <img id="usageLogo" class="usage-logo" alt="Usage logo" src="https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png">
</div>

<div id="logoModal" class="color-modal" aria-hidden="true">
  <button class="close-modal" aria-label="Close">↙</button>
  <img id="logoModalImg" class="usage-logo" alt="Full logo">
</div>

<script>
// Color swatch modal
(function(){
  const modal=document.getElementById('colorModal');
  const close=modal.querySelector('.close-modal');
  const toggle=modal.querySelector('.toggle-logo');
  const logo=modal.querySelector('#usageLogo');
  const logos=[
    'https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png',
    'https://i.ibb.co/rGKS5vTC/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered.png',
    'https://i.ibb.co/Lh8MQXSZ/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered-2.png'
  ];
  let logoIndex=0;
  function updateLogo(){ logo.src=logos[logoIndex]; }
  updateLogo();

  toggle.addEventListener('click',()=>{
    logoIndex=(logoIndex+1)%logos.length;
    updateLogo();
  });

  document.querySelectorAll('#colors .swatch').forEach(sw=>{
    sw.addEventListener('click',()=>{
      const chip=sw.querySelector('.chip');
      if(!chip) return;
      const color=getComputedStyle(chip).backgroundColor;
      modal.style.background=color;
      modal.style.display='flex';
    });
  });
  function hide(){
    modal.style.display='none';
    logoIndex=0;
    updateLogo();
  }
  close.addEventListener('click',hide);
  modal.addEventListener('click',e=>{if(e.target===modal)hide();});
  document.addEventListener('keydown',e=>{if(e.key==='Escape')hide();});
})();

// Logo fullscreen modal
(function(){
  const modal=document.getElementById('logoModal');
  const img=modal.querySelector('#logoModalImg');
  const close=modal.querySelector('.close-modal');
    function hide(){modal.style.display='none';img.src='';}
    document.querySelectorAll('.fullscreen-link').forEach(link=>{
      link.addEventListener('click',e=>{
        e.preventDefault();
        img.src=link.href;
        modal.style.background=link.dataset.bg||'rgba(0,0,0,.8)';
        modal.style.display='flex';
      });
    });
  close.addEventListener('click',hide);
  modal.addEventListener('click',e=>{if(e.target===modal)hide();});
  document.addEventListener('keydown',e=>{if(e.key==='Escape')hide();});
})();

// Idle-only floating sprites in the hero
(function(){
  const particles = document.getElementById('particles');
  const R = (a,b)=> a + Math.random()*(b-a);

  function spawn(kind, x, y){
    const el = document.createElement('div');
    el.className = 'sprite ' + kind;
    const sv = document.createElementNS('http://www.w3.org/2000/svg','svg');
    sv.setAttribute('viewBox','0 0 100 80');
    const use = document.createElementNS('http://www.w3.org/2000/svg','use');
    use.setAttributeNS('http://www.w3.org/1999/xlink','href', kind==='bird'?'#BIRD_RIG':'#BUTTER_RIG');
    sv.appendChild(use); el.appendChild(sv);
    particles.appendChild(el);

    const w = particles.getBoundingClientRect().width;
    const h = particles.getBoundingClientRect().height;
    const px = (x ?? R(w*0.1, w*0.9));
    const py = (y ?? R(h*0.2, h*0.8));

    el.style.left = (px - 22) + 'px';
    el.style.top  = (py - 20) + 'px';
    el.style.setProperty('--dur', Math.round(R(5200, 8200)) + 'ms');
    el.style.setProperty('--flap', Math.round(R(900, 1400)) + 'ms');
    el.style.setProperty('--arc', R(10,16) + 'deg');
    el.style.setProperty('--start', R(-2,2) + 'deg');
    el.style.setProperty('--end', R(-4,2) + 'deg');
  }

  // a couple floating friends
  spawn('bird'); spawn('butter');
  setTimeout(()=> spawn('butter'), 600);
})();

// Global flock following cursor
(function(){
  const layer=document.createElement('div');
  layer.className='flock-layer';
  document.body.appendChild(layer);
  const rand=(a,b)=>a+Math.random()*(b-a);
  const kinds=['BIRD_RIG','BUTTER_RIG'];
  function make(x,y,kind){
    const el=document.createElement('div');
    el.className='flock';
    el.style.setProperty('--x',x+'px');
    el.style.setProperty('--y',y+'px');
    el.style.setProperty('--dx',rand(-120,120)+'px');
    el.style.setProperty('--dy',rand(-200,-100)+'px');
    el.style.setProperty('--r0',rand(-22,22)+'deg');
    el.style.setProperty('--r1',rand(-28,8)+'deg');
    el.style.setProperty('--s',rand(0.8,1.2));
    el.style.setProperty('--dur',rand(4000,7000)+'ms');
    el.style.setProperty('--flap',rand(900,1600)+'ms');
    el.innerHTML=`<svg viewBox="0 0 100 80" width="100%" height="100%"><use href="#${kind}"/></svg>`;
    layer.appendChild(el);
    requestAnimationFrame(()=>el.classList.add('fly'));
    el.addEventListener('animationend',()=>el.remove(),{once:true});
  }
  function flock(x,y,count=6){ for(let i=0;i<count;i++) make(x,y,kinds[Math.floor(Math.random()*kinds.length)]); }
  let last=0;
  document.addEventListener('mousemove',e=>{const now=Date.now(); if(now-last>800){last=now; make(e.clientX,e.clientY,kinds[Math.floor(Math.random()*kinds.length)]);} });
  document.addEventListener('click',e=>flock(e.clientX,e.clientY,8));
})();

// Logo upload & previews
(function(){
  const input = document.getElementById('logoUpload');
  const stage = document.getElementById('logoStage');
  const light = document.getElementById('logoLight');
  const dark  = document.getElementById('logoDark');
  const mainLink = document.getElementById('logoStageLink');

  document.querySelector('label[for="logoUpload"]').addEventListener('click',()=> input.click());

  function clear(node){ while(node && node.firstChild) node.removeChild(node.firstChild); }
  function renderPreview(target, dataURL){
    if(!target) return;
    let img = target.querySelector('img');
    if(!img){
      img = document.createElement('img');
      img.style.width='80%'; img.style.height='auto';
      target.appendChild(img);
    }
    img.src = dataURL;
    let link = target.querySelector('.fullscreen-link');
    if(!link){
      link = document.createElement('a');
      link.className='fullscreen-link';
      link.removeAttribute('target');
      link.setAttribute('aria-label','Open full image');
      target.appendChild(link);
    }
    link.href = dataURL;
  }

  input.addEventListener('change', async (e)=>{
    const file = e.target.files?.[0];
    if(!file) return;
    const ext = (file.name.split('.').pop()||'').toLowerCase();
    if(ext==='ai' || file.type==='application/pdf'){
      const note = document.createElement('div');
      note.style.cssText = 'position:absolute;bottom:10px;left:10px;background:rgba(255,255,255,.9);padding:8px 10px;border-radius:10px;font-size:12px;color:#333;box-shadow:0 4px 14px rgba(0,0,0,.08)';
      note.textContent = 'AI/PDF cannot preview in-browser. In Illustrator: File → Export As → SVG (or PNG), then upload here.';
      stage.appendChild(note);
      return;
    }

    const reader = new FileReader();
    reader.onload = ()=>{
      const url = reader.result;
      const imgEl = stage.querySelector('#brandLogoIMG');
      if(imgEl){ imgEl.src = url; }
      else{
        const holder = document.createElement('img');
        holder.id = 'brandLogoIMG'; holder.alt = 'Uploaded logo';
        holder.src = url; holder.style.width='80%'; holder.style.height='auto';
        stage.appendChild(holder);
      }
      if(mainLink) mainLink.href = url;
      renderPreview(light, url);
      renderPreview(dark, url);
    };
    reader.readAsDataURL(file);
  });
})();

// Export PNG (transparent) for the centered logo (uploaded or inline)
(function(){
  const btn = document.getElementById('exportPNG');
  const toggle = document.getElementById('toggleBG');
  const stage = document.getElementById('logoStage');

  function exportPNG(){
    const size = 3000; // 3000x3000px
    const canvas = document.createElement('canvas');
    canvas.width = size; canvas.height = size;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,size,size);

    const nodeImg = stage.querySelector('#brandLogoIMG');

    function drawAndSave(img){
      const scale = 0.8; // match visual scale
      const s = size * scale;
      const x = (size - s)/2; const y = (size - s)/2;
      ctx.drawImage(img, x, y, s, s);
      canvas.toBlob((blob)=>{
        const a = document.createElement('a');
        a.download = 'AGLM_Logo_1x1_center_3000.png';
        a.href = URL.createObjectURL(blob);
        a.click(); URL.revokeObjectURL(a.href);
      }, 'image/png');
    }

    if(nodeImg){
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = ()=> drawAndSave(img);
      img.src = nodeImg.src;
    }
  }

  function toggleBG(){
    const current = getComputedStyle(stage).backgroundColor;
    stage.style.background = (current === 'rgba(0, 0, 0, 0)' || current === 'transparent') ? 'var(--neutral3)' : 'transparent';
  }

  btn?.addEventListener('click', exportPNG);
  toggle?.addEventListener('click', toggleBG);
})();


  // Typography generator
  (function(){
    const input=document.getElementById('typeInput');
    const fontSel=document.getElementById('fontSelect');
    const sizeInput=document.getElementById('fontSize');
    const posSel=document.getElementById('logoPos');
    const bgSel=document.getElementById('bgColor');
    const nextLogo=document.getElementById('typeNextLogo');
    const canvas=document.getElementById('typeCanvas');
    const ctx=canvas.getContext('2d');
    const preview=document.getElementById('typePreview');
    const btn=document.getElementById('downloadPNG');
    const logos=[
      'https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png',
      'https://i.ibb.co/rGKS5vTC/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered.png',
      'https://i.ibb.co/Lh8MQXSZ/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered-2.png'
    ];
    let lidx=0;
    const logo=new Image();
    logo.crossOrigin='anonymous';
    logo.src=logos[lidx];

    function render(){
      ctx.clearRect(0,0,3000,3000);
      ctx.fillStyle=bgSel.value;
      ctx.fillRect(0,0,3000,3000);
      ctx.fillStyle='#111';
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      const fs=parseInt(sizeInput.value,10)||120;
      ctx.font=fs+'px '+fontSel.value;
      const lines=input.value.split('\n');
      const lh=fs*1.25;
      const start=1500 - ((lines.length-1)/2)*lh;
      lines.forEach((line,i)=>ctx.fillText(line,1500,start + i*lh));
      const pos=posSel.value;
      const size=300;
      let dw=0,dh=0;
      if(logo.width && logo.height){
        const scale=size/Math.max(logo.width,logo.height);
        dw=logo.width*scale;
        dh=logo.height*scale;
      }
      const map={
        'bottom-right':[3000-dw-50,3000-dh-50],
        'bottom-left':[50,3000-dh-50],
        'top-right':[3000-dw-50,50],
        'top-left':[50,50],
        'top-center':[(3000-dw)/2,50],
        'bottom-center':[(3000-dw)/2,3000-dh-50]
      };
      if(dw && dh && map[pos]) ctx.drawImage(logo,map[pos][0],map[pos][1],dw,dh);
      const url=canvas.toDataURL('image/png');
      preview.style.backgroundImage=`url(${url})`;
      preview.style.backgroundSize='cover';
      return url;
    }
    [input,fontSel,sizeInput,posSel,bgSel].forEach(el=>el?.addEventListener('input',render));
    nextLogo?.addEventListener('click',()=>{ lidx=(lidx+1)%logos.length; logo.src=logos[lidx]; });
    logo.onload=render;
    btn?.addEventListener('click',()=>{const url=render();const a=document.createElement('a');a.href=url;a.download='typography.png';a.click();});
    render();
  })();
// Social template uploads, logo cycling & downloads
(function(){
  const logos=[
    'https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png',
    'https://i.ibb.co/rGKS5vTC/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered.png',
    'https://i.ibb.co/Lh8MQXSZ/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered-2.png'
  ];
  const colors=['#2c6fb1','#6fb1ff','#1d3f73','#de9146','#111111','#dbb5c2','#efe5d7','#ebe9d5','#f3f0ec'];
  let idx=0; let currentColor='#f3f0ec';
  let userMedia=null; let showLogo=true; let showShadow=false;
  const imgs=document.querySelectorAll('#logoTemplates .template-img');
  const canvases=document.querySelectorAll('#logoTemplates .canvas');
  const texts=document.querySelectorAll('#logoTemplates .template-text');
  const ghosts=document.querySelectorAll('#logoTemplates .ghost');
  const colorWrap=document.getElementById('templateColors');
  const upload=document.getElementById('mediaUpload');
  const recordBtn=document.getElementById('recordVideo');
  const textInput=document.getElementById('templateText');
  const fontSel=document.getElementById('templateFont');
  const posSel=document.getElementById('templateLogoPos');
  const removeBtn=document.getElementById('removeMedia');
  const toggleBtn=document.getElementById('toggleLogo');
  const shadowBtn=document.getElementById('toggleShadow');
  const sizeInput=document.getElementById('templateSize');
  const textXInput=document.getElementById('textX');
  const textYInput=document.getElementById('textY');
  const borderColorSel=document.getElementById('borderColor');
  const borderWidthInput=document.getElementById('borderWidth');
  let mediaRecorder=null; let recordedChunks=[];
  let logoPos='center';
  let textX=0, textY=0;
  let borderColor='', borderSize=0;

  function fitText(el, base){
    let size=base||32;
    el.style.fontSize=size+'px';
    const parent=el.parentElement;
    if(!parent) return;
    let maxH=parent.clientHeight*0.9;
    if(parent.classList.contains('logo-center')||parent.classList.contains('logo-top')||parent.classList.contains('logo-bottom')){
      maxH=parent.clientHeight*0.5;
    }
    while((el.scrollWidth>parent.clientWidth*0.9 || el.scrollHeight>maxH) && size>12){
      size-=1;
      el.style.fontSize=size+'px';
    }
  }

  colors.forEach(c=>{
    const sw=document.createElement('div');
    sw.className='swatch';
    sw.innerHTML=`<div class="chip" style="background:${c}"></div>`;
    sw.addEventListener('click',()=>{
      currentColor=c;
      canvases.forEach(cv=>cv.style.background=c);
    });
    colorWrap?.appendChild(sw);
  });

  function render(){
    imgs.forEach(img=>{ if(showLogo){ img.src=logos[idx]; img.style.display='block'; } else { img.style.display='none'; }});
    canvases.forEach(cv=>{
      cv.style.background=currentColor;
      cv.classList.remove('logo-center','logo-top','logo-bottom','logo-left','logo-right');
      cv.classList.add('logo-'+logoPos);
      cv.querySelector('.border-overlay')?.remove();
      if(borderColor && borderSize>0){
        const bo=document.createElement('div');
        bo.className='border-overlay';
        bo.style.border=`${borderSize}px solid ${borderColor}`;
        cv.appendChild(bo);
      }
      const old=cv.querySelector('.user-media');
      if(old) old.remove();
      if(userMedia){
        const clone=userMedia.cloneNode(true);
        clone.classList.add('user-media');
        if(clone.tagName==='VIDEO'){
          clone.loop=true; clone.muted=true; clone.playsInline=true; clone.src=userMedia.src; clone.load(); clone.play();
        }
        cv.prepend(clone);
      }
    });
    texts.forEach(t=>{
      t.textContent=textInput.value;
      t.style.fontFamily=fontSel.value;
      t.style.textShadow=showShadow?'0 0 4px rgba(0,0,0,.6)':'none';
      t.style.fontSize=(sizeInput?.value||32)+'px';
      t.style.transform=`translate(${textX}%,${textY}%)`;
      fitText(t, parseInt(sizeInput?.value||32,10));
    });
    ghosts.forEach(g=> g.style.display=userMedia?'none':'block');
  }

  document.getElementById('cycleLogo')?.addEventListener('click',()=>{ idx=(idx+1)%logos.length; render(); });
  toggleBtn?.addEventListener('click',()=>{ showLogo=!showLogo; toggleBtn.textContent=showLogo?'Hide Logo':'Show Logo'; render(); });
  shadowBtn?.addEventListener('click',()=>{ showShadow=!showShadow; shadowBtn.textContent=showShadow?'Remove Shadow':'Add Shadow'; render(); });
  removeBtn?.addEventListener('click',()=>{ userMedia=null; upload.value=''; render(); });
  textInput?.addEventListener('input',render);
  fontSel?.addEventListener('change',render);
  posSel?.addEventListener('change',()=>{ logoPos=posSel.value; render(); });
  sizeInput?.addEventListener('input',render);
  textXInput?.addEventListener('input',()=>{ textX=parseInt(textXInput.value,10); render(); });
  textYInput?.addEventListener('input',()=>{ textY=parseInt(textYInput.value,10); render(); });
  borderColorSel?.addEventListener('change',()=>{ borderColor=borderColorSel.value; render(); });
  borderWidthInput?.addEventListener('input',()=>{ borderSize=parseInt(borderWidthInput.value,10); render(); });
  window.addEventListener('resize',()=>texts.forEach(t=>fitText(t, parseInt(sizeInput?.value||32,10))));

  recordBtn?.addEventListener('click', async ()=>{
    if(mediaRecorder && mediaRecorder.state!=='inactive'){
      mediaRecorder.stop();
      recordBtn.textContent='Record Video';
      return;
    }
    try{
      const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
      recordedChunks=[];
      mediaRecorder=new MediaRecorder(stream);
      mediaRecorder.ondataavailable=e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
      mediaRecorder.onstop=()=>{
        const blob=new Blob(recordedChunks,{type:'video/webm'});
        stream.getTracks().forEach(t=>t.stop());
        const url=URL.createObjectURL(blob);
        const vid=document.createElement('video');
        vid.src=url;
        vid.onloadedmetadata=()=>{
          if(vid.duration>60){ alert('Recorded video is longer than 60s.'); return; }
          vid.loop=true; vid.muted=true; vid.playsInline=true; vid.play();
          userMedia=vid; render();
        };
      };
      mediaRecorder.start();
      recordBtn.textContent='Stop Recording';
      setTimeout(()=>{ if(mediaRecorder && mediaRecorder.state!=='inactive'){ mediaRecorder.stop(); recordBtn.textContent='Record Video'; } },60000);
    }catch(err){ console.error(err); }
  });

  upload?.addEventListener('change',e=>{
    const file=e.target.files?.[0];
    if(!file) return;
    const url=URL.createObjectURL(file);
    if(file.type.startsWith('image/')){
      const img=new Image();
      img.onload=()=>{userMedia=img; render();};
      img.src=url;
    }else if(file.type.startsWith('video/')){
      const vid=document.createElement('video');
      vid.src=url;
      vid.onloadedmetadata=()=>{
        if(vid.duration>60){ alert('Please select a video 60s or shorter.'); return; }
        vid.loop=true; vid.muted=true; vid.playsInline=true; vid.play();
        userMedia=vid; render();
      };
    }
  });

  render();

  function download(type){
    if(userMedia && userMedia.tagName==='VIDEO'){
      downloadVideo(type);
      return;
    }
    const map={square:[1080,1080],portrait:[1080,1350],landscape:[1920,1080]};
    const [w,h]=map[type];
    const canvas=document.createElement('canvas');
    canvas.width=w; canvas.height=h;
    const ctx=canvas.getContext('2d');
    ctx.fillStyle=currentColor; ctx.fillRect(0,0,w,h);

    if(userMedia){
      let mw,mh;
      if(userMedia.tagName==='IMG'){ mw=userMedia.naturalWidth; mh=userMedia.naturalHeight; }
      else{ mw=userMedia.videoWidth; mh=userMedia.videoHeight; }
      const scale=Math.max(w/mw,h/mh);
      const dw=mw*scale, dh=mh*scale;
      ctx.drawImage(userMedia,(w-dw)/2,(h-dh)/2,dw,dh);
    }

    const pos=posSel.value;
    const text=textInput.value.trim();
    if(showLogo){
      const logo=new Image();
      logo.crossOrigin='anonymous';
      logo.onload=()=>{
        let lw=pos==='center'? w*0.6 : w*0.25;
        if(pos==='top'||pos==='bottom') lw=w*0.3;
        const lh=lw*logo.height/logo.width;
        let lx,ly;
        switch(pos){
          case 'center': lx=(w-lw)/2; ly=(h-lh)/2; break;
          case 'top': lx=(w-lw)/2; ly=40; break;
          case 'bottom': lx=(w-lw)/2; ly=h-lh-40; break;
          case 'left': lx=40; ly=(h-lh)/2; break;
          case 'right': lx=w-lw-40; ly=(h-lh)/2; break;
        }

        let maxWidth=(pos==='left'||pos==='right')? w-lw-120 : w*0.9;
        let fontSize=w/10;
        ctx.font=`${fontSize}px ${fontSel.value}`;
        while(text && ctx.measureText(text).width>maxWidth && fontSize>20){
          fontSize-=2;
          ctx.font=`${fontSize}px ${fontSel.value}`;
        }
        let textX=w/2, textY=h/2, textAlign='center', textBaseline='middle';
        switch(pos){
          case 'left': textAlign='left'; textBaseline='middle'; textX=lx+lw+40; textY=h/2; break;
          case 'right': textAlign='right'; textBaseline='middle'; textX=lx-40; textY=h/2; break;
        }
        if(text){
          ctx.fillStyle='#fff';
          ctx.textAlign=textAlign;
          ctx.textBaseline=textBaseline;
          if(showShadow){ctx.shadowColor='rgba(0,0,0,.6)';ctx.shadowBlur=4;}
          ctx.fillText(text,textX,textY);
          if(showShadow){ctx.shadowColor='transparent';ctx.shadowBlur=0;}
        }
        ctx.drawImage(logo,lx,ly,lw,lh);
        if(borderColor && borderSize>0){
          ctx.strokeStyle=borderColor;
          ctx.lineWidth=borderSize*2;
          ctx.strokeRect(borderSize, borderSize, w-borderSize*2, h-borderSize*2);
        }
        canvas.toBlob(b=>{const a=document.createElement('a');a.download=`AGLM_${type}.png`;a.href=URL.createObjectURL(b);a.click();URL.revokeObjectURL(a.href);});
      };
      logo.src=logos[idx];
    }else{
      let fontSize=w/10;
      ctx.font=`${fontSize}px ${fontSel.value}`;
      while(text && ctx.measureText(text).width>w*0.9 && fontSize>20){
        fontSize-=2;
        ctx.font=`${fontSize}px ${fontSel.value}`;
      }
      ctx.fillStyle='#fff';
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      if(text){
        if(showShadow){ctx.shadowColor='rgba(0,0,0,.6)';ctx.shadowBlur=4;}
        ctx.fillText(text,w/2,h/2);
        if(showShadow){ctx.shadowColor='transparent';ctx.shadowBlur=0;}
      }
      if(borderColor && borderSize>0){
        ctx.strokeStyle=borderColor;
        ctx.lineWidth=borderSize*2;
        ctx.strokeRect(borderSize, borderSize, w-borderSize*2, h-borderSize*2);
      }
      canvas.toBlob(b=>{const a=document.createElement('a');a.download=`AGLM_${type}.png`;a.href=URL.createObjectURL(b);a.click();URL.revokeObjectURL(a.href);});
    }
  }

  async function downloadVideo(type){
    const map={square:[1080,1080],portrait:[1080,1350],landscape:[1920,1080]};
    const [w,h]=map[type];
    const canvas=document.createElement('canvas');
    canvas.width=w; canvas.height=h;
    const ctx=canvas.getContext('2d');
    const stream=canvas.captureStream(30);
    const recorder=new MediaRecorder(stream,{mimeType:'video/webm'});
    const chunks=[];
    recorder.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
    recorder.onstop=()=>{
      const blob=new Blob(chunks,{type:'video/webm'});
      const a=document.createElement('a');
      a.download=`AGLM_${type}.webm`;
      a.href=URL.createObjectURL(blob);
      a.click();
    };
    const vid=userMedia.cloneNode(true);
    vid.loop=false; vid.muted=true; vid.playsInline=true;
    const pos=posSel.value;
    const text=textInput.value.trim();
    const offsetXP=textX;
    const offsetYP=textY;
    let lw,lh,lx,ly,fontSize,textX=w/2,textY=h/2,textAlign='center',textBaseline='middle',maxWidth=w*0.9;
    function calcText(){
      fontSize=w/10;
      ctx.font=`${fontSize}px ${fontSel.value}`;
      while(text && ctx.measureText(text).width>maxWidth && fontSize>20){
        fontSize-=2; ctx.font=`${fontSize}px ${fontSel.value}`;
      }
      switch(pos){
        case 'left': textAlign='left'; textBaseline='middle'; textX=lx+lw+40; textY=h/2; break;
        case 'right': textAlign='right'; textBaseline='middle'; textX=lx-40; textY=h/2; break;
      }
      textX += offsetXP/100*w;
      textY += offsetYP/100*h;
    }
    function drawFrame(){
      ctx.fillStyle=currentColor; ctx.fillRect(0,0,w,h);
      const mw=vid.videoWidth, mh=vid.videoHeight;
      const scale=Math.max(w/mw,h/mh);
      const dw=mw*scale, dh=mh*scale;
      ctx.drawImage(vid,(w-dw)/2,(h-dh)/2,dw,dh);
      ctx.font=`${fontSize}px ${fontSel.value}`;
      if(text){
        ctx.fillStyle='#fff';
        ctx.textAlign=textAlign;
        ctx.textBaseline=textBaseline;
        if(showShadow){ctx.shadowColor='rgba(0,0,0,.6)';ctx.shadowBlur=4;}
        ctx.fillText(text,textX,textY);
        if(showShadow){ctx.shadowColor='transparent';ctx.shadowBlur=0;}
      }
      if(showLogo) ctx.drawImage(logo,lx,ly,lw,lh);
      if(borderColor && borderSize>0){
        ctx.strokeStyle=borderColor;
        ctx.lineWidth=borderSize*2;
        ctx.strokeRect(borderSize, borderSize, w-borderSize*2, h-borderSize*2);
      }
      if(!vid.paused && !vid.ended) requestAnimationFrame(drawFrame);
    }
    recorder.start();
    vid.onended=()=>recorder.stop();
    let logoLoaded=!showLogo;
    const logo=new Image();
    logo.crossOrigin='anonymous';
    logo.onload=()=>{logoLoaded=true; lw=pos==='center'? w*0.6 : w*0.25; if(pos==='top'||pos==='bottom') lw=w*0.3; lh=lw*logo.height/logo.width; switch(pos){case 'center': lx=(w-lw)/2; ly=(h-lh)/2; break; case 'top': lx=(w-lw)/2; ly=40; break; case 'bottom': lx=(w-lw)/2; ly=h-lh-40; break; case 'left': lx=40; ly=(h-lh)/2; break; case 'right': lx=w-lw-40; ly=(h-lh)/2; break;} maxWidth=(pos==='left'||pos==='right')? w-lw-120 : w*0.9; calcText(); vid.play(); drawFrame();};
    if(showLogo){ logo.src=logos[idx]; }
    if(!showLogo){ calcText(); vid.play(); drawFrame(); }
  }

  document.querySelectorAll('.download').forEach(btn=>btn.addEventListener('click',()=>download(btn.dataset.size)));
})();

// Break videos cycling & downloads
(function(){
  const videos=['assets/social 1.mp4','assets/social 2.mp4','assets/social 3.mp4'];
  const colors=['#2c6fb1','#6fb1ff','#1d3f73','#de9146','#111111','#dbb5c2','#efe5d7','#ebe9d5','#f3f0ec'];
  let vidIdx=0; let currentColor='#f3f0ec';
  const vids=document.querySelectorAll('.break-video');
  const canvases=document.querySelectorAll('#breakTemplates .canvas');
  const ghosts=document.querySelectorAll('#breakTemplates .ghost');
  const colorWrap=document.getElementById('videoColors');

  colors.forEach(c=>{
    const sw=document.createElement('div');
    sw.className='swatch';
    sw.innerHTML=`<div class="chip" style="background:${c}"></div>`;
    sw.addEventListener('click',()=>{currentColor=c; canvases.forEach(cv=>cv.style.background=c);});
    colorWrap?.appendChild(sw);
  });

  function render(){
    vids.forEach(v=>{v.src=videos[vidIdx]; v.load(); v.play();});
    canvases.forEach(cv=>cv.style.background=currentColor);
    ghosts.forEach(g=>g.style.display='none');
  }
  document.getElementById('cycleVideo')?.addEventListener('click',()=>{vidIdx=(vidIdx+1)%videos.length; render();});
  render();
  vids.forEach(v=>{
    v.addEventListener('mouseenter',()=>v.play());
    v.addEventListener('mouseleave',()=>v.pause());
    const toggle=()=>{ if(v.paused) v.play(); else v.pause(); };
    v.addEventListener('click',toggle);
    v.addEventListener('touchstart',e=>{ toggle(); e.preventDefault(); });
  });

  document.querySelectorAll('.download-vid').forEach(btn=>btn.addEventListener('click',async()=>{
    const response=await fetch(videos[vidIdx]);
    const blob=await response.blob();
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download=`AGLM_break_${btn.dataset.size}.mp4`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }));
})();

// Live photo color guide with camera controls
(function(){
  const video=document.getElementById('video');
  if(!video) return;
  const canvas=document.getElementById('canvas');
  const ctx=canvas.getContext('2d');
  const suggestion=document.getElementById('suggestion');
  const combos=document.getElementById('combos');
    const colorBtn=document.getElementById('colorBtn');
  const startBtn=document.getElementById('startBtn');
  const stopBtn=document.getElementById('stopBtn');
  const switchBtn=document.getElementById('switchBtn');
  const downloadBtn=document.getElementById('downloadPhoto');
  const fullscreenBtn=document.getElementById('fullscreenBtn');
    const overlaySelect=document.getElementById('overlaySelect');
    const overlayText=document.getElementById('overlayText');
    const overlayLogo=document.getElementById('overlayLogo');
    const captionInput=document.getElementById('captionInput');
    const captionColor=document.getElementById('captionColor');
    const colorOverlay=document.getElementById('colorOverlay');
    const fsControls=document.getElementById('fsControls');
    const exitFs=document.getElementById('exitFs');
    const fsCapture=document.getElementById('fsCapture');
    const palette=['#2c6fb1','#6fb1ff','#1d3f73','#de9146','#111111','#dbb5c2','#efe5d7','#ebe9d5','#f3f0ec'];
    const logos={logo1:'https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png',logo2:'https://i.ibb.co/rGKS5vTC/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered.png',logo3:'https://i.ibb.co/Lh8MQXSZ/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered-2.png'};
    let colorIndex=-1;
  let stream=null;
  let facing='environment';
  let analyzing=false;
  let overlayType='none';

  function luminance(hex){
    const r=parseInt(hex.substr(1,2),16)/255;
    const g=parseInt(hex.substr(3,2),16)/255;
    const b=parseInt(hex.substr(5,2),16)/255;
    return 0.2126*r+0.7152*g+0.0722*b;
  }

  function analyze(){
    if(!analyzing) return;
    if(video.readyState>=2){
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let red=0,green=0,blue=0;
      for(let i=0;i<data.length;i+=4){red+=data[i];green+=data[i+1];blue+=data[i+2];}
      const count=data.length/4;
      red/=count;green/=count;blue/=count;
      const sorted=[...palette].sort((c1,c2)=>colorDistance(c1,red,green,blue)-colorDistance(c2,red,green,blue)).slice(0,3);
      combos.innerHTML='';
      const fsSwatches=fsControls.querySelectorAll('.swatch');
      sorted.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='swatch';
        div.style.background=c;
        combos.appendChild(div);
        if(fsSwatches[i]){
          fsSwatches[i].style.background=c;
          fsSwatches[i].dataset.color=c;
        }
      });
      const bright=(0.2126*red+0.7152*green+0.0722*blue)/255;
      let best=palette[0],bestScore=0;
      palette.forEach(c=>{
        const contrast=Math.abs(luminance(c)-bright);
        if(contrast>bestScore){bestScore=contrast;best=c;}
      });
      suggestion.textContent=`Best color: ${best}`;
      suggestion.style.color=best;
    }
    requestAnimationFrame(analyze);
  }

  async function startCamera(){
    try{
      if(stream) stream.getTracks().forEach(t=>t.stop());
        stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:facing}});
        video.srcObject=stream;
        await video.play();
      analyzing=true;
      requestAnimationFrame(analyze);
      suggestion.textContent='';
    }catch(e){
      suggestion.textContent='Camera access is required.';
    }
  }

  function stopCamera(){
    if(stream){stream.getTracks().forEach(t=>t.stop());}
    stream=null; analyzing=false; video.srcObject=null;
    suggestion.textContent='Camera inactive.';
  }

  function colorDistance(hex,rVal,gVal,bVal){
    const R=parseInt(hex.substr(1,2),16);
    const G=parseInt(hex.substr(3,2),16);
    const B=parseInt(hex.substr(5,2),16);
    return Math.sqrt((R-rVal)**2 + (G-gVal)**2 + (B-bVal)**2);
  }

  colorBtn?.addEventListener('click',()=>{
    colorIndex=(colorIndex+1)%(palette.length+1);
    if(colorIndex===palette.length){
      colorOverlay.style.display='none';
    }else{
      colorOverlay.style.background=palette[colorIndex];
      colorOverlay.style.display='block';
    }
  });

  startBtn?.addEventListener('click',startCamera);
  stopBtn?.addEventListener('click',stopCamera);
  switchBtn?.addEventListener('click',()=>{facing=facing==='user'?'environment':'user';startCamera();});

    overlaySelect?.addEventListener('change',()=>{
      overlayType=overlaySelect.value;
      overlayText.style.display='none';
      overlayLogo.style.display='none';
      captionInput.style.display='none';
      captionColor.style.display='none';
      if(overlayType==='text'){
        overlayText.textContent=captionInput.value;
        overlayText.style.color=captionColor.value;
        overlayText.style.display='block';
        captionInput.style.display='block';
        captionColor.style.display='block';
      }else if(logos[overlayType]){
        overlayLogo.src=logos[overlayType];
        overlayLogo.style.display='block';
      }
    });

    captionInput?.addEventListener('input',()=>{
      if(overlayType==='text') overlayText.textContent=captionInput.value;
    });

    captionColor?.addEventListener('input',()=>{
      if(overlayType==='text') overlayText.style.color=captionColor.value;
    });

  function capture(){
    if(!stream) return;
    const w=video.videoWidth; const h=video.videoHeight;
    canvas.width=w; canvas.height=h;
    ctx.drawImage(video,0,0,w,h);
    if(overlayType==='text' && overlayText.textContent){
      ctx.font='40px Sora';
      ctx.fillStyle=captionColor.value;
      ctx.textAlign='center';
      const lines=overlayText.textContent.split('\n');
      lines.forEach((line,i)=>ctx.fillText(line,w/2,h-60-(lines.length-1-i)*44));
    }else if(logos[overlayType] && overlayLogo.complete){
      const ow=overlayLogo.naturalWidth,oh=overlayLogo.naturalHeight;
      const scale=120/ow; const lw=ow*scale, lh=oh*scale;
      ctx.drawImage(overlayLogo,(w-lw)/2,h-lh-20,lw,lh);
    }
    const a=document.createElement('a');
    a.download='photo.png';
    a.href=canvas.toDataURL('image/png');
    a.click();
  }
  downloadBtn?.addEventListener('click',capture);
  fsCapture?.addEventListener('click',capture);

    fullscreenBtn?.addEventListener('click',()=>{
      const el=document.getElementById('photoTool');
      if(el.requestFullscreen) el.requestFullscreen();
      else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if(video.webkitEnterFullscreen) video.webkitEnterFullscreen();
    });
    exitFs?.addEventListener('click',()=>{
      if(document.exitFullscreen) document.exitFullscreen();
      else if(document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if(video.webkitExitFullscreen) video.webkitExitFullscreen();
    });

  document.addEventListener('fullscreenchange',()=>{
    const pt=document.getElementById('photoTool');
    if(document.fullscreenElement===pt){
      pt.classList.add('fullscreen');
    }else{
      pt.classList.remove('fullscreen');
      colorOverlay.style.display='none';
    }
  });

  fsControls?.querySelectorAll('.swatch').forEach(sw=>{
    sw.addEventListener('click',()=>{
      colorOverlay.style.background=sw.dataset.color;
      colorOverlay.style.display='block';
    });
  });
})();

// Brand color utilities
(function(){
  const brandPalette=['#2c6fb1','#6fb1ff','#1d3f73','#de9146','#111111','#dbb5c2','#efe5d7','#ebe9d5','#f3f0ec'];
  let customColors=[];
  const colorBtn=document.getElementById('colorOfDayBtn');
  const colorDisplay=document.getElementById('colorOfDayDisplay');
  colorBtn?.addEventListener('click',async()=>{
    const c=await colorOfDay();
    if(!c) return;
    colorDisplay.style.display='block';
    const chip=colorDisplay.querySelector('.chip');
    const code=colorDisplay.querySelector('code');
    chip.style.background=c; code.textContent=c;
  });

  async function colorOfDay(){
    const now=new Date();
    let timeFactor=now.getHours();
    let weatherFactor=0;
    try{
      const pos=await new Promise((res,rej)=>{
        if(!navigator.geolocation) return rej();
        navigator.geolocation.getCurrentPosition(p=>res({lat:p.coords.latitude,lon:p.coords.longitude}),rej,{timeout:5000});
      });
      const resp=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.lat}&longitude=${pos.lon}&current_weather=true`);
      const data=await resp.json();
      weatherFactor=Math.round(data.current_weather.temperature)%brandPalette.length;
    }catch(e){}
    const astroMap={Aries:0,Taurus:1,Gemini:2,Cancer:3,Leo:4,Virgo:5,Libra:6,Scorpio:7,Sagittarius:8,Capricorn:0,Aquarius:1,Pisces:2};
    const astroFactor=astroMap[getAstroSign(now)]||0;
    const idx=(timeFactor+weatherFactor+astroFactor)%brandPalette.length;
    return brandPalette[idx];
  }

  function getAstroSign(d){
    const m=d.getMonth()+1, day=d.getDate();
    if((m==3&&day>=21)||(m==4&&day<=19)) return 'Aries';
    if((m==4&&day>=20)||(m==5&&day<=20)) return 'Taurus';
    if((m==5&&day>=21)||(m==6&&day<=20)) return 'Gemini';
    if((m==6&&day>=21)||(m==7&&day<=22)) return 'Cancer';
    if((m==7&&day>=23)||(m==8&&day<=22)) return 'Leo';
    if((m==8&&day>=23)||(m==9&&day<=22)) return 'Virgo';
    if((m==9&&day>=23)||(m==10&&day<=22)) return 'Libra';
    if((m==10&&day>=23)||(m==11&&day<=21)) return 'Scorpio';
    if((m==11&&day>=22)||(m==12&&day<=21)) return 'Sagittarius';
    if((m==12&&day>=22)||(m==1&&day<=19)) return 'Capricorn';
    if((m==1&&day>=20)||(m==2&&day<=18)) return 'Aquarius';
    return 'Pisces';
  }

  const wheel=document.getElementById('colorWheel');
  const compDisp=document.getElementById('complementaryDisplay');
  wheel?.addEventListener('input',()=>{
    const c=wheel.value;
    const comp=getComplement(c);
    compDisp.style.display='block';
    compDisp.querySelector('.chip').style.background=comp;
    compDisp.querySelector('code').textContent=comp;
  });

  function getComplement(hex){
    const [h,s,l]=hexToHsl(hex);
    return hslToHex((h+180)%360,s,l);
  }
  function hexToHsl(H){
    let r=0,g=0,b=0;
    H=H.replace('#','');
    r=parseInt(H.substring(0,2),16)/255;
    g=parseInt(H.substring(2,4),16)/255;
    b=parseInt(H.substring(4,6),16)/255;
    const max=Math.max(r,g,b), min=Math.min(r,g,b);
    let h=0,s=0,l=(max+min)/2;
    if(max!==min){
      const d=max-min;
      s=l>0.5? d/(2-max-min) : d/(max+min);
      switch(max){
        case r: h=(g-b)/d + (g<b?6:0); break;
        case g: h=(b-r)/d + 2; break;
        case b: h=(r-g)/d + 4; break;
      }
      h/=6;
    }
    return [h*360,s,l];
  }
  function hslToHex(h,s,l){
    h/=360;
    let r,g,b;
    if(s===0){r=g=b=l;}else{
      const q=l<0.5? l*(1+s) : l+s-l*s;
      const p=2*l-q;
      const hue2rgb=t=>{
        if(t<0) t+=1;
        if(t>1) t-=1;
        if(t<1/6) return p+(q-p)*6*t;
        if(t<1/2) return q;
        if(t<2/3) return p+(q-p)*(2/3-t)*6;
        return p;
      };
      r=hue2rgb(h+1/3); g=hue2rgb(h); b=hue2rgb(h-1/3);
    }
    const toHex=x=>Math.round(x*255).toString(16).padStart(2,'0');
    return '#'+toHex(r)+toHex(g)+toHex(b);
  }

  const customPicker=document.getElementById('customColorPicker');
  const customBtn=document.getElementById('addCustomColor');
  const customWrap=document.getElementById('customSwatches');
  customBtn?.addEventListener('click',()=>{
    const c=customPicker.value;
    customColors.push(c);
    const sw=document.createElement('div');
    sw.className='swatch';
    sw.innerHTML=`<div class="chip" style="background:${c}"></div><h4>Custom</h4><code>${c}</code>`;
    customWrap.appendChild(sw);
  });

  document.getElementById('downloadSwatches')?.addEventListener('click',()=>{
    const all=[...brandPalette,...customColors];
    const blob=new Blob([all.join('\n')],{type:'text/plain'});
    const a=document.createElement('a');
    a.download='AGLM_swatches.txt';
    a.href=URL.createObjectURL(blob);
    a.click();
    URL.revokeObjectURL(a.href);
  });
})();

// Menu toggle
(function(){
  const btn=document.getElementById('menuToggle');
  const nav=document.querySelector('.header nav');
  btn?.addEventListener('click',()=>nav?.classList.toggle('hidden'));
})();

// Light/Dark mode toggles
(function(){
  const light=document.getElementById('lightMode');
  const dark=document.getElementById('darkMode');
  light?.addEventListener('click',()=>document.body.classList.remove('dark'));
  dark?.addEventListener('click',()=>document.body.classList.add('dark'));
})();

// Secret title logo swap
(function(){
  const text=document.getElementById('titleText');
  const logo=document.getElementById('titleLogo');
  document.querySelector('.brand h1')?.addEventListener('click',()=>{
    if(logo.classList.contains('show')){
      logo.classList.remove('show');
      text.classList.remove('hidden');
    }else{
      text.classList.add('hidden');
      logo.classList.add('show');
    }
  });
})();

// Photo example video interactions
(function(){
  const v=document.getElementById('photoExampleVideo');
  if(!v) return;
  v.play().catch(()=>{});
  const toggle=()=>{ if(v.paused) v.play(); else v.pause(); };
  v.addEventListener('click',toggle);
  v.addEventListener('touchstart',e=>{ toggle(); e.preventDefault(); });
})();
</script>
<style>
  #aglm-dont-gallery{display:flex;flex-wrap:wrap;gap:14px;margin-top:14px}
  #aglm-dont-input{margin-top:10px}
  #aglm-pinterest{margin-top:14px;border-radius:12px}
  #aglm-carousel-controls textarea{min-height:60px}
  #aglm-carousel-canvas{margin-top:14px}
  .rank{position:absolute;top:8px;left:8px;background:rgba(255,255,255,.9);padding:4px 6px;border-radius:6px;font-size:12px;font-weight:700;color:#333}
  .vote-btn{position:absolute;bottom:8px;right:8px;border:none;background:var(--blue1);color:#fff;border-radius:50%;width:28px;height:28px;cursor:pointer;font-size:16px}
  .vote-btn:hover{background:var(--blue2)}
</style>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const key='aglm-dont-items';
  const dontInput=document.getElementById('aglm-dont-input');
  const dontGallery=document.getElementById('aglm-dont-gallery');
  const THIRTY_DAYS=30*24*60*60*1000;
  let items=[];
  try{items=JSON.parse(localStorage.getItem(key)||'[]');}catch(e){items=[];}
  const now=Date.now();
  items=items.filter(i=>now-i.time<THIRTY_DAYS);
  localStorage.setItem(key,JSON.stringify(items));
  function renderDont(){
    if(!dontGallery) return;
    dontGallery.innerHTML='';
    const ranked=[...items].sort((a,b)=>(b.votes||0)-(a.votes||0)).slice(0,5);
    ranked.forEach((it,idx)=>{
      const frame=document.createElement('div');
      frame.className='frame';
      frame.style.position='relative';
      const rank=document.createElement('div');
      rank.className='rank';
      rank.textContent='#'+(idx+1);
      frame.appendChild(rank);
      const canvas=document.createElement('div');
      canvas.className='canvas square';
      let el;
      if(it.type==='video'){el=document.createElement('video');el.src=it.data;el.controls=true;}
      else{el=document.createElement('img');el.src=it.data;}
      canvas.appendChild(el);
      frame.appendChild(canvas);
      const vote=document.createElement('button');
      vote.className='vote-btn';
      vote.textContent='▲';
      vote.addEventListener('click',()=>{it.votes=(it.votes||0)+1;localStorage.setItem(key,JSON.stringify(items));renderDont();});
      frame.appendChild(vote);
      dontGallery.appendChild(frame);
    });
  }
  renderDont();
  dontInput?.addEventListener('change',e=>{
    const files=[...e.target.files];
    files.forEach(f=>{
      const r=new FileReader();
      r.onload=ev=>{
        items.push({type:f.type.startsWith('video')?'video':'image',data:ev.target.result,time:Date.now(),votes:0});
        localStorage.setItem(key,JSON.stringify(items));
        renderDont();
      };
      r.readAsDataURL(f);
    });
    dontInput.value='';
  });

  const canvas=document.getElementById('aglm-carousel-canvas');
  const ctx=canvas?.getContext('2d');
  if(ctx) ctx.imageSmoothingQuality='high';
  function wrapText(text,x,y,maxWidth,lineHeight){
    const words=text.split(' ');let line='';
    for(let n=0;n<words.length;n++){
      const test=line+words[n]+' ';
      if(ctx.measureText(test).width>maxWidth&&n>0){ctx.fillText(line,x,y);line=words[n]+' ';y+=lineHeight;}else{line=test;}
    }
    ctx.fillText(line,x,y);
  }
  const logos=[
    'https://i.ibb.co/DDXtHnk4/A-Grief-Like-Mine-Top-1-transparent.png',
    'https://i.ibb.co/rGKS5vTC/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered.png',
    'https://i.ibb.co/Lh8MQXSZ/A-GRIEF-LIKE-MINE-Kinetic-Typography-transparent-Recovered-2.png'
  ];
  function draw(){
    if(!ctx) return;
    const type=document.getElementById('aglm-template-type').value;
    const aspect=document.getElementById('aglm-aspect').value;
    const headline=document.getElementById('aglm-headline').value;
    const details=document.getElementById('aglm-details').value;
    const bgUrl=document.getElementById('aglm-bg-url').value;
    const bgFile=document.getElementById('aglm-bg-file').files[0];
    const bgColor=document.getElementById('aglm-bg-color').value;
    const accent=document.getElementById('aglm-accent-color').value;
    const textColor=document.getElementById('aglm-text-color').value;
    const fontFamily=document.getElementById('aglm-font-family').value;
    const fontWeight=document.getElementById('aglm-font-weight').value;
    const logoIdx=parseInt(document.getElementById('aglm-logo-select').value,10);
    const logoPos=document.getElementById('aglm-logo-pos').value;
    const logoSize=parseInt(document.getElementById('aglm-logo-size').value,10)||300;
    const headlineSize=parseInt(document.getElementById('aglm-headline-size').value,10)||70;
    const detailsSize=parseInt(document.getElementById('aglm-details-size').value,10)||40;
    const textY=parseInt(document.getElementById('aglm-text-y').value,10)||540;
    const w=1080,h=aspect==='square'?1080:1350;
    const dpr=window.devicePixelRatio||1;
    canvas.width=w*dpr;canvas.height=h*dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.fillStyle=bgColor;
    ctx.fillRect(0,0,w,h);
    const finish=()=>{
      ctx.fillStyle=accent;
      ctx.fillRect(0,h-200,w,200);
      ctx.fillStyle=textColor;
      ctx.textAlign='center';
      ctx.font=`${fontWeight} ${headlineSize}px ${fontFamily}, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif`;
      wrapText(headline,w/2,textY,w*0.8,headlineSize*1.2);
      ctx.font=`${fontWeight} ${detailsSize}px ${fontFamily}, system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif`;
      wrapText(details,w/2,textY+headlineSize+20,w*0.8,detailsSize*1.25);
      ctx.font='italic 40px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif';
      ctx.fillStyle='#fff';
      const footer=type==='save'?'Save the Date':'Event Announcement';
      ctx.fillText(footer,w/2,h-80);
      const logo=new Image();
      logo.crossOrigin='anonymous';
      logo.onload=()=>{
        const scale=logoSize/Math.max(logo.width,logo.height);
        const dw=logo.width*scale;
        const dh=logo.height*scale;
        const posMap={
          'bottom-right':[w-dw-50,h-dh-50],
          'bottom-left':[50,h-dh-50],
          'top-right':[w-dw-50,50],
          'top-left':[50,50]
        };
        const [lx,ly]=posMap[logoPos];
        ctx.drawImage(logo,lx,ly,dw,dh);
      };
      logo.src=logos[logoIdx];
    };
    const handleFinish=()=>{ctx.globalAlpha=1;finish();};
    if(bgFile){
      if(bgFile.type.startsWith('video')){
        const v=document.createElement('video');
        v.src=URL.createObjectURL(bgFile);
        v.onloadeddata=()=>{ctx.globalAlpha=0.25;ctx.drawImage(v,0,0,w,h);URL.revokeObjectURL(v.src);handleFinish();};
        v.load();
      }else{
        const img=new Image();
        img.onload=()=>{ctx.globalAlpha=0.25;ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(img.src);handleFinish();};
        img.src=URL.createObjectURL(bgFile);
      }
    }else if(bgUrl){
      if(/\.mp4$/i.test(bgUrl)){
        const v=document.createElement('video');
        v.crossOrigin='anonymous';
        v.src=bgUrl;
        v.onloadeddata=()=>{ctx.globalAlpha=0.25;ctx.drawImage(v,0,0,w,h);handleFinish();};
      }else{
        const img=new Image();
        img.crossOrigin='anonymous';
        img.onload=()=>{ctx.globalAlpha=0.25;ctx.drawImage(img,0,0,w,h);handleFinish();};
        img.onerror=handleFinish;
        img.src=bgUrl;
      }
    }else finish();
  }
  document.getElementById('aglm-generate')?.addEventListener('click',draw);
  document.getElementById('aglm-download')?.addEventListener('click',()=>{
    const link=document.createElement('a');
    link.download='aglm-carousel.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
  });
  document.getElementById('aglm-print')?.addEventListener('click',()=>{
    const w=window.open('');
    w.document.write('<img src="'+canvas.toDataURL('image/png')+'" style="width:100%">');
    w.document.close();
    w.focus();
    w.print();
  });
  document.getElementById('aglm-aspect')?.addEventListener('change',e=>{
    const textY=document.getElementById('aglm-text-y');
    textY.value=e.target.value==='square'?540:675;
  });
});
</script>
</body>
</html>
